<script language="javascript" type="text/javascript">var opt=$.mainParam[0];var type=$.mainParam[1];var stk=$.mainParam[2];var pStk;var wanInfName="";var wanInf;var portTrigCfg;var ptAttrs={};function isPortStr(val){var c;var ch="0123456789-,";for(var i=0;i<val.length;i++){c=val.charAt(i);if(ch.indexOf(c)==-1){return false}}for(var i=0;i<val.split(",").length;i++){if(val.split(",")[i]==""){return false}if((val.split(",")[i].split("-").length!=1)&&(val.split(",")[i].split("-").length!=2)){return false}if((val.split(",")[i].split("-").length==2)&&(val.split(",")[i].split("-")[0]=="")){return false}if((val.split(",")[i].split("-").length==2)&&(val.split(",")[i].split("-")[1]=="")){return false}}return true}function init(){var aliasName=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);if(INCLUDE_WAN_MODE){var sysMode=$.act(ACT_GET,SYS_MODE,null,null,["mode"])}if(INCLUDE_USB_3G_DONGLE){var wan3glnkcfgList=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"])}if(INCLUDE_IPV6){var wanIPList=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType","X_TP_IPv4Enabled"]);var wanPPPList=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","X_TP_IPv4Enabled","transportType"]);if(INCLUDE_L2TP){var wanL2TPList=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"])}if(INCLUDE_PPTP){var wanPPTPList=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}}else{var wanIPList=$.act(ACT_GL,WAN_IP_CONN,null,null,["enable","name","NATEnabled","connectionType"]);var wanPPPList=$.act(ACT_GL,WAN_PPP_CONN,null,null,["enable","name","NATEnabled","transportType"]);if(INCLUDE_L2TP){var wanL2TPList=$.act(ACT_GL,WAN_L2TP_CONN,null,null,["enable","name","NATEnabled"])}if(INCLUDE_PPTP){var wanPPTPList=$.act(ACT_GL,WAN_PPTP_CONN,null,null,["enable","name","NATEnabled"])}}var sel=$.id("wanInf");if(!$.exe()){if(opt==1){pStk=stk[0]+","+stk[1]+","+stk[2]+",0,0,0";if(type=="ip"){portTrigCfg=$.act(ACT_GET,IP_CONN_PORTTRIGGERING,stk,null,["triggerPort","triggerProtocol","openPort","openProtocol","enable"]);wanInf=$.act(ACT_GET,WAN_IP_CONN,pStk,null,["name"])}else{if(type=="ppp"){portTrigCfg=$.act(ACT_GET,PPP_CONN_PORTTRIGGERING,stk,null,["triggerPort","triggerProtocol","openPort","openProtocol","enable"]);wanInf=$.act(ACT_GET,WAN_PPP_CONN,pStk,null,["name"])}else{if(type=="l2tp"){pStk=stk[0]+","+stk[1]+",0,0,0,0";portTrigCfg=$.act(ACT_GET,L2TP_CONN_PORTTRIGGERING,stk,null,["triggerPort","triggerProtocol","openPort","openProtocol","enable"]);wanInf=$.act(ACT_GET,WAN_L2TP_CONN,pStk,null,["name"])}else{if(type=="pptp"){pStk=stk[0]+","+stk[1]+",0,0,0,0";portTrigCfg=$.act(ACT_GET,PPTP_CONN_PORTTRIGGERING,stk,null,["triggerPort","triggerProtocol","openPort","openProtocol","enable"]);wanInf=$.act(ACT_GET,WAN_PPTP_CONN,pStk,null,["name"])}}}}if(!$.exe()){wanInfName=wanInf.name;$.id("triggerPort").value=portTrigCfg.triggerPort;$.id("trigTCP").selected=(portTrigCfg.triggerProtocol=="TCP")?1:0;$.id("trigUDP").selected=(portTrigCfg.triggerProtocol=="UDP")?1:0;$.id("trigALL").selected=(portTrigCfg.triggerProtocol=="TCP or UDP")?1:0;$.id("openPort").value=portTrigCfg.openPort;$.id("openTCP").selected=(portTrigCfg.openProtocol=="TCP")?1:0;$.id("openUDP").selected=(portTrigCfg.openProtocol=="UDP")?1:0;$.id("openALL").selected=(portTrigCfg.openProtocol=="TCP or UDP")?1:0;$.id("portTrig_en").selected=(portTrigCfg.enable==1)?1:0;$.id("portTrig_dis").selected=(portTrigCfg.enable==1)?0:1}}else{wanInfName=aliasName.__ifAliasName}var mode;if(INCLUDE_WAN_MODE){mode=sysMode.mode}var usb3gBackup=0;if(INCLUDE_USB_3G_DONGLE){$.each(wan3glnkcfgList,function(){if(this.enable==1){usb3gBackup=this.backupEnable;return false}})}var index=0;var flag=0;for(var i=0;i<wanIPList.length;i++){if((wanIPList[i].NATEnabled==1)&&(wanIPList[i].connectionType=="IP_Routed")&&(wanIPList[i].enable==1)&&(!INCLUDE_IPV6||wanIPList[i].X_TP_IPv4Enabled==1)){var option=$.c("option");option.value="ip:"+wanIPList[i].__stack;option.text=wanIPList[i].name;try{sel.add(option,null)}catch(e){sel.add(option)}index++;if(wanIPList[i].name==wanInfName){sel.selectedIndex=index-1}flag=1}}for(var j=0;j<wanPPPList.length;j++){if((wanPPPList[j].NATEnabled==1)&&((wanPPPList[j].enable==1)||(wanPPPList[j].transportType=="PPP3G"&&(mode=="USB_3G"||usb3gBackup==1)))&&(!INCLUDE_IPV6||wanPPPList[j].X_TP_IPv4Enabled==1)){var option=$.c("option");option.value="ppp:"+wanPPPList[j].__stack;option.text=wanPPPList[j].name;try{sel.add(option,null)}catch(e){sel.add(option)}index++;if(wanPPPList[j].name==wanInfName){sel.selectedIndex=index-1}flag=1}}if(INCLUDE_L2TP){for(var j=0;j<wanL2TPList.length;j++){if(wanL2TPList[j].enable==1){var option=$.c("option");option.value="l2tp:"+wanL2TPList[j].__stack;option.text=wanL2TPList[j].name;try{sel.add(option,null)}catch(e){sel.add(option)}index++;if(wanL2TPList[j].name==wanInfName){sel.selectedIndex=index-1}flag=1}}}if(INCLUDE_PPTP){for(var j=0;j<wanPPTPList.length;j++){if(wanPPTPList[j].enable==1){var option=$.c("option");option.value="pptp:"+wanPPTPList[j].__stack;option.text=wanPPTPList[j].name;try{sel.add(option,null)}catch(e){sel.add(option)}index++;if(wanPPTPList[j].name==wanInfName){sel.selectedIndex=index-1}flag=1}}}if(flag==0){var option=$.c("option");option.value="";option.text="No available interface.";try{sel.add(option,null)}catch(e){sel.add(option)}$.id("saveBtn").disabled=1}}}function checkConflictFtpDataPort(port){if((59990<=port)&&(port<=59999)){$.alert(ERR_FTP_DATA_PORT_CONFLICT);return false}return true}function checkConflictFtpPort(port){var ftpServer=$.act(ACT_GET,FTP_SERVER,null,null,null);if($.exe()){return}if(((ftpServer.enable==1)&&(ftpServer.accessFromInternet==1)&&(port==ftpServer.portNumber))){if(confirm(c_str.forwarding_ftp_conflict)){$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]);$.exe();return true}else{return false}}return true}function doSave(){var tmpWanInfType=($.id("wanInf").value).split(":")[0];var tmpWanInfStk=($.id("wanInf").value).split(":")[1];if(($.id("triggerPort").value=="")||($.num($.id("triggerPort").value,true))){$.alert(ERR_NUM_INVAD);var element=$.id("triggerPort");if(element){element.focus();element.select()}return false}ptAttrs.triggerPort=parseInt($.id("triggerPort").value,10);ptAttrs.triggerProtocol=$.id("triggerProt").value;ptAttrs.openProtocol=$.id("openProt").value;ptAttrs.enable=($.id("portTrig_en").selected==1)?1:0;if(($.id("openPort").value=="")||(!isPortStr($.id("openPort").value))){$.alert(ERR_NUM_INVAD);var element=$.id("openPort");if(element){element.focus();element.select()}return false}ptAttrs.openPort=$.id("openPort").value;if(INCLUDE_USB_FTP_SERVER){if(!checkConflictFtpDataPort(ptAttrs.triggerPort)||(ptAttrs.enable&&!checkConflictFtpPort(ptAttrs.triggerPort))){var element=$.id("triggerPort");if(element){element.focus();element.select()}return false}if(!checkConflictFtpDataPort(ptAttrs.openPort)||(ptAttrs.enable&&!checkConflictFtpPort(ptAttrs.openPort))){var element=$.id("openPort");if(element){element.focus();element.select()}return false}}$.addLoading($.id("saveBtn"));if(opt==0){if(tmpWanInfType=="ip"){$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,tmpWanInfStk,ptAttrs)}else{if(tmpWanInfType=="ppp"){$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,tmpWanInfStk,ptAttrs)}else{if(tmpWanInfType=="l2tp"){$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,tmpWanInfStk,ptAttrs)}else{if(tmpWanInfType=="pptp"){$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,tmpWanInfStk,ptAttrs)}}}}$.exe(function(ret){if(!ret){$.loadMain("portTrigger.htm")}})}else{if(opt==1){if(wanInfName==$.id("wanInf").options[$.id("wanInf").selectedIndex].text){if(type=="ip"){$.act(ACT_SET,IP_CONN_PORTTRIGGERING,stk,null,ptAttrs)}else{if(type=="ppp"){$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,stk,null,ptAttrs)}else{if(type=="l2tp"){$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,stk,null,ptAttrs)}else{if(type=="pptp"){$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,stk,null,ptAttrs)}}}}$.exe(function(ret){if(!ret){$.loadMain("portTrigger.htm")}})}else{if(type=="ip"){$.act(ACT_DEL,IP_CONN_PORTTRIGGERING,stk,null)}else{if(type=="ppp"){$.act(ACT_DEL,PPP_CONN_PORTTRIGGERING,stk,null)}else{if(type=="l2tp"){$.act(ACT_DEL,L2TP_CONN_PORTTRIGGERING,stk,null)}else{if(type=="pptp"){$.act(ACT_DEL,PPTP_CONN_PORTTRIGGERING,stk,null)}}}}$.exe(function(ret){if(!ret){if(tmpWanInfType=="ip"){$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,tmpWanInfStk,ptAttrs)}else{if(tmpWanInfType=="ppp"){$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,tmpWanInfStk,ptAttrs)}else{if(tmpWanInfType=="l2tp"){$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,tmpWanInfStk,ptAttrs)}else{if(tmpWanInfType=="pptp"){$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,tmpWanInfStk,ptAttrs)}}}}$.exe(function(ret){if(!ret){$.loadMain("portTrigger.htm")}else{ptAttrs.triggerPort=portTrigCfg.triggerPort;ptAttrs.openPort=portTrigCfg.openPort;ptAttrs.openProtocol=portTrigCfg.openProtocol;ptAttrs.enable=portTrigCfg.enable;if(type=="ip"){$.act(ACT_ADD,IP_CONN_PORTTRIGGERING,null,pStk,ptAttrs)}else{if(type=="ppp"){$.act(ACT_ADD,PPP_CONN_PORTTRIGGERING,null,pStk,ptAttrs)}else{if(type=="l2tp"){$.act(ACT_ADD,L2TP_CONN_PORTTRIGGERING,null,pStk,ptAttrs)}else{if(type=="pptp"){$.act(ACT_ADD,PPTP_CONN_PORTTRIGGERING,null,pStk,ptAttrs)}}}}$.exe()}})}})}}}}function changeApply(){var apply=$.id("commApply").value;if(apply=="Battle.net"){$.id("triggerPort").value="6112";$.id("openPort").value="6112"}else{if(apply=="Dialpad"){$.id("triggerPort").value="7175";$.id("openPort").value="51200-51201,51210"}else{if(apply=="ICU II"){$.id("triggerPort").value="2019";$.id("openPort").value="2000-2038,2050-2051,2069,2085,3010-3030"}else{if(apply=="MSN Gaming Zone"){$.id("triggerPort").value="47624";$.id("openPort").value="2300-2400,28800-29000"}else{if(apply=="PC-to-Phone"){$.id("triggerPort").value="12053";$.id("openPort").value="12120,12122,24150-24220"}else{if(apply=="Quick Time 4"){$.id("triggerPort").value="554";$.id("openPort").value="6970-6999"}else{if(apply=="AOE II Client"){$.id("triggerPort").value="47624";$.id("openPort").value="2300-2400,28800-29000"}else{if(apply=="Sudden Strike"){$.id("triggerPort").value="47624";$.id("openPort").value="2300-2400"}else{if(apply=="Baldurs Gate II"){$.id("triggerPort").value="47624";$.id("openPort").value="2300-2400"}else{$.id("triggerPort").value="";$.id("openPort").value=""}}}}}}}}}$.id("trigALL").selected=1;$.id("openALL").selected=1;$.id("portTrig_en").selected=1};</script>
<p class="et T" id="et">Port Trigger</p>
<div class="con1 L">
<p class="ct"></p>
<p class="bl"></p>
<div class="con2">
<p class="L2 nd"><b class="item M T T_intf">Interface:</b><select class="L" id="wanInf"onchange=""></select></p>
<p class="br nd"></p>
<p class="L2"><b class="item M T" id="t_tport">Trigger Port:</b><input type="text" class="text" id="triggerPort" size="15"  maxlength="5" />(XX)</p>
<p class="L2"><b class="item M T" id="t_tproto">Trigger Protocol:</b>
<select class="L" id="triggerProt">
<option class="T T_all" value="TCP or UDP" id="trigALL">All</option>
<option value="TCP" id="trigTCP">TCP</option>
<option value="UDP"id="trigUDP">UDP</option>
</select></p>
<p class="L2"><b class="item M T" id="t_oport">Open Port:</b><input type="text" class="text" id="openPort" size="15" maxlength="59"/>(XX or XX-XX or XX-XX,XX)</p>
<p class="L2"><b class="item M T" id="t_oproto">Open Protocol:</b>
<select class="L" id="openProt">
<option class="T T_all" value="TCP or UDP" id="openALL">All</option>
<option value="TCP" id="openTCP">TCP</option>
<option value="UDP" id="openUDP">UDP</option>
</select></p>
<p class="L2"><b class="item M T T_status">Status:</b><select class="L" id="state">
<option value="1" class="T T_enabled" id="portTrig_en">Enabled</option>
<option value="0" class="T T_disabled" id="portTrig_dis">Disabled</option>
</select></p>
<p class="L2"><b class="item M T" id="t_cport">Common Service Port:</b><select class="L" id="commApply" onchange="changeApply();">
<option class="T" id="t_sel" value="please">---Please Select---</option>
<option value="Battle.net">Battle.net</option>
<option value="Dialpad">Dialpad</option>
<option value="ICU II">ICU II</option>
<option value="MSN Gaming Zone">MSN Gaming Zone</option>
<option value="PC-to-Phone">PC-to-Phone</option>
<option value="Quick Time 4">Quick Time 4</option>
<option value="AOE II Client">AOE II Client</option>
<option value="Sudden Strike">Sudden Strike</option>
<option value="Baldurs Gate II">Baldurs Gate II</option>
</select></p>
</div>
<p class="bl"></p>
<p class="tail" id="tail">
<input type="button" class="button L T T_save" id="saveBtn" value="Save" onclick="doSave();" />
<input type="button" class="button L T T_back" value="Back" onclick="$.loadMain('portTrigger.htm')"/>
</p>
</div>
<script language="javascript" type="text/javascript">$.loadHelp();init();</script>