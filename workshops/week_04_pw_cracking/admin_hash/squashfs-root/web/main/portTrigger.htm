<script language="javascript" type="text/javascript">var selAll;var index;var allStk;var allStkType;var portTrig_stack;var portTrig_stackType;var portTrig_stackIndex;var param;function doAdd(){param[0]=0;$.loadMain("portTrigEdit.htm",param)}function doEdit(val1,val2){param[0]=1;param[1]=val1;param[2]=val2;$.loadMain("portTrigEdit.htm",param)}function doSelAll(){if(selAll==0){for(var i=1;i<=index;i++){var portTrigid="portTrigid"+i;$.id(portTrigid).checked=1}portTrig_stack=[];portTrig_stackType=[];portTrig_stackIndex=index;for(var j=0;j<portTrig_stackIndex;j++){portTrig_stack[j]=allStk[j];portTrig_stackType[j]=allStkType[j]}selAll=1}else{if(selAll==1){for(var i=1;i<=index;i++){var tmpEntryid="portTrigid"+i;$.id(tmpEntryid).checked=0}portTrig_stack=[];portTrig_stackType=[];portTrig_stackIndex=0;selAll=0}}}function selEntry(){portTrig_stack=[];portTrig_stackIndex=0;portTrig_stackType=[];for(var i=1;i<=index;i++){var tmpEntryId="portTrigid"+i;if($.id(tmpEntryId).checked==1){portTrig_stack[portTrig_stackIndex]=allStk[i-1];portTrig_stackType[portTrig_stackIndex]=allStkType[i-1];portTrig_stackIndex++}}}function clickSel(){if(selAll==1){$.id("selAll").checked=0;selAll=0}}function init(){selAll=0;index=0;param=[];allStk=[];allStkType=[];portTrig_param=[];portTrig_stack=[];portTrig_stackType=[];portTrig_stackIndex=0;var portTrigList_IP=$.act(ACT_GL,IP_CONN_PORTTRIGGERING,null,null);var portTrigList_PPP=$.act(ACT_GL,PPP_CONN_PORTTRIGGERING,null,null);if(INCLUDE_USB_3G_DONGLE){var wan3glnkcfgList=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"])}if(INCLUDE_L2TP){var portTrigList_L2TP=$.act(ACT_GL,L2TP_CONN_PORTTRIGGERING,null,null)}if(INCLUDE_PPTP){var portTrigList_PPTP=$.act(ACT_GL,PPTP_CONN_PORTTRIGGERING,null,null)}if(!$.exe()){var usb3gBackup=0;if(INCLUDE_USB_3G_DONGLE){$.each(wan3glnkcfgList,function(){if(this.enable==1){usb3gBackup=this.backupEnable;return false}})}var tbl=$.id("portTrigtbl");$.each(portTrigList_IP,function(){if(INCLUDE_WAN_MODE){var sysMode=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);var wanCommIntfCfgList=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);if(!$.exe()){var notShow=0;var mode=(sysMode.mode=="ETH")?"Ethernet":sysMode.mode;var tmpStk=$.stkPop(this.__stack,3);$.each(wanCommIntfCfgList,function(){if(tmpStk==this.__stack&&this.WANAccessType!=mode){notShow=1;return}});if(notShow==1){return}}}var thisStk="["+this.__stack+"]";var row=tbl.insertRow(-1);index++;var cell=row.insertCell(-1);cell.width="5%";cell.innerHTML="<input type='checkbox' id='portTrigid"+index+"' onclick='clickSel();'/>";cell=row.insertCell(-1);cell.width="15%";cell.innerHTML=this.triggerPort;cell=row.insertCell(-1);cell.width="18%";if(this.triggerProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.triggerProtocol}cell=row.insertCell(-1);cell.innerHTML=$.resizeStr(this.openPort,15);cell=row.insertCell(-1);cell.width="16%";if(this.openProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.openProtocol}cell=row.insertCell(-1);cell.width="10%";cell.innerHTML=(this.enable==1)?"<span class='T T_enabled'>"+m_str.enabled+"</span>":"<span class='T T_disabled'>"+m_str.disabled+"</span>";cell=row.insertCell(-1);cell.width="7%";cell.innerHTML="<span class='a T T_edit' onclick='doEdit(\"ip\", "+thisStk+");'>"+m_str.edit+"</span>";allStk[index-1]=this.__stack;allStkType[index-1]="ip"});$.each(portTrigList_PPP,function(){var notShow=0;if(INCLUDE_WAN_MODE){var sysMode=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);var wanCommIntfCfgList=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"]);if(!$.exe()){var mode=(sysMode.mode=="ETH")?"Ethernet":sysMode.mode;var tmpStk=$.stkPop(this.__stack,3);$.each(wanCommIntfCfgList,function(){if(tmpStk==this.__stack&&this.WANAccessType!=mode&&(this.WANAccessType!="USB_3G"||usb3gBackup!=1)){notShow=1;return}})}}else{$.each(wanCommIntfCfgList,function(){if(tmpStk==this.__stack&&this.WANAccessType=="USB_3G"&&usb3gBackup!=1){notShow=1;return}})}if(notShow==1){return}var thisStk="["+this.__stack+"]";var row=tbl.insertRow(-1);index++;var cell=row.insertCell(-1);cell.width="5%";cell.innerHTML="<input type='checkbox' id='portTrigid"+index+"'/>";cell=row.insertCell(-1);cell.width="15%";cell.innerHTML=this.triggerPort;cell=row.insertCell(-1);cell.width="18%";if(this.triggerProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.triggerProtocol}cell=row.insertCell(-1);cell.innerHTML=$.resizeStr(this.openPort,15);cell=row.insertCell(-1);cell.width="16%";if(this.openProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.openProtocol}cell=row.insertCell(-1);cell.width="10%";cell.innerHTML=(this.enable==1)?"<span class='T T_en'>"+m_str.enabled+"</span>":"<span class='T T_dis'>"+m_str.disabled+"</span>";cell=row.insertCell(-1);cell.width="7%";cell.innerHTML="<span class='a T T_edit' onclick='doEdit(\"ppp\", "+thisStk+");'>"+m_str.edit+"</span>";allStk[index-1]=this.__stack;allStkType[index-1]="ppp"});if(INCLUDE_L2TP){$.each(portTrigList_L2TP,function(){var thisStk="["+this.__stack+"]";var row=tbl.insertRow(-1);index++;var cell=row.insertCell(-1);cell.width="5%";cell.innerHTML="<input type='checkbox' id='portTrigid"+index+"'/>";cell=row.insertCell(-1);cell.width="15%";cell.innerHTML=this.triggerPort;cell=row.insertCell(-1);cell.width="18%";if(this.triggerProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.triggerProtocol}cell=row.insertCell(-1);cell.innerHTML=$.resizeStr(this.openPort,15);cell=row.insertCell(-1);cell.width="16%";if(this.openProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.openProtocol}cell=row.insertCell(-1);cell.width="10%";cell.innerHTML=(this.enable==1)?"<span class='T T_en'>"+m_str.enabled+"</span>":"<span class='T T_dis'>"+m_str.disabled+"</span>";cell=row.insertCell(-1);cell.width="7%";cell.innerHTML="<span class='a T T_edit' onclick='doEdit(\"l2tp\", "+thisStk+");'>"+m_str.edit+"</span>";allStk[index-1]=this.__stack;allStkType[index-1]="l2tp"})}if(INCLUDE_PPTP){$.each(portTrigList_PPTP,function(){var thisStk="["+this.__stack+"]";var row=tbl.insertRow(-1);index++;var cell=row.insertCell(-1);cell.width="5%";cell.innerHTML="<input type='checkbox' id='portTrigid"+index+"'/>";cell=row.insertCell(-1);cell.width="15%";cell.innerHTML=this.triggerPort;cell=row.insertCell(-1);cell.width="18%";if(this.triggerProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.triggerProtocol}cell=row.insertCell(-1);cell.innerHTML=$.resizeStr(this.openPort,15);cell=row.insertCell(-1);cell.width="16%";if(this.openProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.openProtocol}cell=row.insertCell(-1);cell.width="10%";cell.innerHTML=(this.enable==1)?"<span class='T T_en'>"+m_str.enabled+"</span>":"<span class='T T_dis'>"+m_str.disabled+"</span>";cell=row.insertCell(-1);cell.width="7%";cell.innerHTML="<span class='a T T_edit' onclick='doEdit(\"pptp\", "+thisStk+");'>"+m_str.edit+"</span>";allStk[index-1]=this.__stack;allStkType[index-1]="pptp"})}$.resize($.id("portTrigtbl"),8)}}function checkConflictFtpPort(port){var ftpServer=$.act(ACT_GET,FTP_SERVER,null,null,null);if($.exe()){return}if(((ftpServer.enable==1)&&(ftpServer.accessFromInternet==1)&&(port==ftpServer.portNumber))){if(confirm(c_str.forwarding_ftp_conflict)){$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]);$.exe();return true}else{$.reload();return false}}return true}function doEnable(obj){selEntry();if(portTrig_stackIndex==0){$.alert(ERR_SEL_INVAD);return}$.addLoading(obj);for(var i=0;i<portTrig_stackIndex;i++){if(portTrig_stackType[i]=="ip"){if(INCLUDE_USB_FTP_SERVER){var ptEntry=$.act(ACT_GET,IP_CONN_PORTTRIGGERING,portTrig_stack[i],null,null);$.exe();if(!checkConflictFtpPort(ptEntry.triggerPort)||!(checkConflictFtpPort(ptEntry.openPort))){return}}$.act(ACT_SET,IP_CONN_PORTTRIGGERING,portTrig_stack[i],null,["enable=1"])}else{if(portTrig_stackType[i]=="ppp"){if(INCLUDE_USB_FTP_SERVER){var ptEntry=$.act(ACT_GET,PPP_CONN_PORTTRIGGERING,portTrig_stack[i],null,null);$.exe();if(!checkConflictFtpPort(ptEntry.triggerPort)||!(checkConflictFtpPort(ptEntry.openPort))){return}}$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,portTrig_stack[i],null,["enable=1"])}else{if(portTrig_stackType[i]=="l2tp"){if(INCLUDE_USB_FTP_SERVER){var ptEntry=$.act(ACT_GET,L2TP_CONN_PORTTRIGGERING,portTrig_stack[i],null,null);$.exe();if(!checkConflictFtpPort(ptEntry.triggerPort)||!(checkConflictFtpPort(ptEntry.openPort))){return}}$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,portTrig_stack[i],null,["enable=1"])}else{if(portTrig_stackType[i]=="pptp"){if(INCLUDE_USB_FTP_SERVER){var ptEntry=$.act(ACT_GET,PPTP_CONN_PORTTRIGGERING,portTrig_stack[i],null,null);$.exe();if(!checkConflictFtpPort(ptEntry.triggerPort)||!(checkConflictFtpPort(ptEntry.openPort))){return}}$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,portTrig_stack[i],null,["enable=1"])}}}}}$.exe(function(ret){if(!ret){$.reload()}})}function doDisable(obj){selEntry();$.addLoading(obj);if(portTrig_stackIndex==0){$.alert(ERR_SEL_INVAD);return}for(var i=0;i<portTrig_stackIndex;i++){if(portTrig_stackType[i]=="ip"){$.act(ACT_SET,IP_CONN_PORTTRIGGERING,portTrig_stack[i],null,["enable=0"])}else{if(portTrig_stackType[i]=="ppp"){$.act(ACT_SET,PPP_CONN_PORTTRIGGERING,portTrig_stack[i],null,["enable=0"])}else{if(portTrig_stackType[i]=="l2tp"){$.act(ACT_SET,L2TP_CONN_PORTTRIGGERING,portTrig_stack[i],null,["enable=0"])}else{if(portTrig_stackType[i]=="pptp"){$.act(ACT_SET,PPTP_CONN_PORTTRIGGERING,portTrig_stack[i],null,["enable=0"])}}}}}$.exe(function(ret){if(!ret){$.reload()}})}function doDel(obj){selEntry();if(portTrig_stackIndex==0){$.alert(ERR_SEL_INVAD);return}$.addLoading(obj);for(var i=0;i<portTrig_stackIndex;i++){if(portTrig_stackType[i]=="ip"){$.act(ACT_DEL,IP_CONN_PORTTRIGGERING,portTrig_stack[i],null)}else{if(portTrig_stackType[i]=="ppp"){$.act(ACT_DEL,PPP_CONN_PORTTRIGGERING,portTrig_stack[i],null)}else{if(portTrig_stackType[i]=="l2tp"){$.act(ACT_DEL,L2TP_CONN_PORTTRIGGERING,portTrig_stack[i],null)}else{if(portTrig_stackType[i]=="pptp"){$.act(ACT_DEL,PPTP_CONN_PORTTRIGGERING,portTrig_stack[i],null)}}}}}$.exe(function(ret){if(!ret){$.reload()}})};</script>
<p class="et T" id="et">Port Trigger</p>
<div class="con1 XL">
<p class="ct"></p>
<p class="bl"></p>
<div class="con2">
<div class="XXL thead" ><table class="XXL bdr tc">
<tr>
<th width="5%"><input type="checkbox" id="selAll" onclick="doSelAll();"/></th>
<th width="15%" class="T" id="t_tport">Trigger Port</th>
<th width="18%" class="T" id="t_proto">Trigger Protocol</th>
<th class="T" id="t_oport">Open Port</th>
<th width="16%" class="T" id="t_oproto">Open Protocol</th>
<th width="10%" class="T T_status">Status</th>
<th width="7%" class="T T_edit">Edit</th>
</tr>
</table></div>
<div class="XXL tbody"><table id="portTrigtbl" class="XXL bdr tc"></table></div>
<p class="br"></p>
<p class="L1"><input type="button" class="button XL T T_addnew" value="Add New" onclick="doAdd();"/><input type="button" class="button XL T T_ensel" value="Enable Selected" onclick="doEnable(this);"/><input type="button" class="button XL T T_dissel" value="Disable Selected" onclick="doDisable(this);"/><input type="button" class="button XL T T_delsel" value="Delete Selected" onclick="doDel(this);"/></p>
</div>
<p class="bl"></p>
<p class="tail" id="tail"><input type="button" class="button L T T_refresh" value="Refresh" onclick="$.addLoading(this, 200, function(){$.reload()});" /></p>
</div>
<script language="javascript" type="text/javascript">$.loadHelpFrame("SpecialAppHelpRpm.htm");init();</script>