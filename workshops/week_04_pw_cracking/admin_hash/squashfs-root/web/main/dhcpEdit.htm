<script language="javascript" type="text/javascript">function init(){var tmpBrname=$.mainParam;var index;var brList=$.act(ACT_GL,L2_BRIDGING_ENTRY,null,null,["bridgeName"]);$.exe(function(err){if(!err){if(brList.length==1){$.addClass($.id("returnBtn"),"nd")}for(index=0;index<brList.length;index++){if(brList[index].bridgeName==tmpBrname){dhcpCfg=$.act(ACT_GET,LAN_HOST_CFG,brList[index].__stack,null,null);ipList=$.act(ACT_GS,LAN_IP_INTF,null,brList[index].__stack,["IPInterfaceIPAddress","IPInterfaceSubnetMask","__ifName"]);if(!$.exe()){$.h($.id("brname"),brList[index].bridgeName);var tmpLanIp=(ipList[0].IPInterfaceIPAddress)?ipList[0].IPInterfaceIPAddress:"0.0.0.0";var tmpNetMask=(ipList[0].IPInterfaceSubnetMask)?ipList[0].IPInterfaceSubnetMask:"0.0.0.0";$.h($.id("lanIp"),tmpLanIp);$.h($.id("netmask"),tmpNetMask);if(dhcpCfg.DHCPServerEnable==0){$.id("dhcp_disable").checked=1;$.addClass($.id("relay_div"),"nd")}else{if(dhcpCfg.DHCPServerEnable==1&&dhcpCfg.DHCPRelay==1){$.id("dhcp_relay").checked=1;$.removeClass($.id("relay_div"),"nd")}else{$.id("dhcp_enable").checked=1;$.addClass($.id("relay_div"),"nd")}}$.id("ip1").value=(dhcpCfg.minAddress)?dhcpCfg.minAddress:"0.0.0.0";$.id("ip2").value=(dhcpCfg.maxAddress)?dhcpCfg.maxAddress:"0.0.0.0";$.id("lease").value=(dhcpCfg.DHCPLeaseTime=="")?1440:(dhcpCfg.DHCPLeaseTime/60);$.id("gateway").value=(dhcpCfg.IPRouters=="")?"0.0.0.0":dhcpCfg.IPRouters;$.id("domain").value=(dhcpCfg.domainName=="")?"":dhcpCfg.domainName;$.id("dnsserver1").value=(dhcpCfg.DNSServers=="")?"0.0.0.0":(dhcpCfg.DNSServers).split(",")[0];$.id("dnsserver2").value=(dhcpCfg.DNSServers=="")?"0.0.0.0":(dhcpCfg.DNSServers).split(",")[1];$.id("rmtSrv").value=(dhcpCfg.X_TP_DhcpRelayServer=="")?"0.0.0.0":dhcpCfg.X_TP_DhcpRelayServer;break}}}}})}function changeDhcpMode(){if($.id("dhcp_disable").checked){$.addClass($.id("relay_div"),"nd")}else{if($.id("dhcp_relay").checked){$.removeClass($.id("relay_div"),"nd")}else{$.addClass($.id("relay_div"),"nd")}}}function doSave(){var element;var dhcpEnable=0;var dhcpRelayEnable=0;if($.id("dhcp_disable").checked){dhcpEnable=0;dhcpRelayEnable=0}else{if($.id("dhcp_enable").checked){dhcpEnable=1;dhcpRelayEnable=0}else{if($.id("dhcp_relay").checked){dhcpEnable=1;dhcpRelayEnable=1}}}if($.ifip($.id("ip1").value,true)){$.alert(ERR_DHCP_START_IP_INVAD);element=$.id("ip1");if(element){element.focus();element.select()}return}if($.ifip($.id("ip2").value,true)){$.alert(ERR_DHCP_END_IP_INVAD);element=$.id("ip2");if(element){element.focus();element.select()}return}if((parseInt($.id("ip1").value.split(".")[3],10)==0)||(parseInt($.id("ip1").value.split(".")[3],10)==255)){$.alert(ERR_DHCP_START_IP_INVAD_1);element=$.id("ip1");if(element){element.focus();element.select()}return false}if((parseInt($.id("ip2").value.split(".")[3],10)==0)||(parseInt($.id("ip2").value.split(".")[3],10)==255)){$.alert(ERR_DHCP_END_IP_INVAD_1);element=$.id("ip2");if(element){element.focus();element.select()}return false}if(!$.isOrderIp($.id("ip1").value,$.id("ip2").value)){$.alert(ERR_TC_IP_ORDER_INVAD);element=$.id("ip2");if(element){element.focus();element.select()}return}if($.num($.id("lease").value,[1,2880],true)){$.alert(ERR_DHCP_LEASE_INVAD);element=$.id("lease");if(element){element.focus();element.select()}return}if(($.id("gateway").value!="")&&($.id("gateway").value!="0.0.0.0")&&($.ifip($.id("gateway").value,true))){$.alert(ERR_DHCP_GATEWAY_INVAD);element=$.id("gateway");if(element){element.focus();element.select()}return}if(($.id("domain").value!="")&&(!$.isdomain($.id("domain").value))){$.alert(ERR_DOMAIN_INVAD);element=$.id("domain");if(element){element.focus();element.select()}return}if(($.id("dnsserver1").value!="")&&($.id("dnsserver1").value!="0.0.0.0")&&($.ifip($.id("dnsserver1").value,true))){$.alert(ERR_DHCP_DNS1_INVAD);element=$.id("dnsserver1");if(element){element.focus();element.select()}return}if(($.id("dnsserver2").value!="")&&($.id("dnsserver2").value!="0.0.0.0")&&($.ifip($.id("dnsserver2").value,true))){$.alert(ERR_DHCP_DNS2_INVAD);element=$.id("dnsserver2");if(element){element.focus();element.select()}return}if((dhcpRelayEnable==1)&&(($.id("rmtSrv").value=="")||($.id("rmtSrv").value=="0.0.0.0"))){$.alert(ERR_DHCP_RMT_SRV_EMPTY);element=$.id("rmtSrv");if(element){element.focus();element.select()}return}if(($.id("rmtSrv").value!="")&&($.id("rmtSrv").value!="0.0.0.0")&&($.ifip($.id("rmtSrv").value,true))){$.alert(ERR_DHCP_RMT_SRV_INVAD);element=$.id("rmtSrv");if(element){element.focus();element.select()}return}$.addLoading($.id("saveBtn"));var tmpMinAddr=($.id("ip1").value)?$.id("ip1").value:"0.0.0.0";var tmpMaxAddr=($.id("ip2").value)?$.id("ip2").value:"0.0.0.0";var tmpGateway=($.id("gateway").value)?$.id("gateway").value:"0.0.0.0";var tmpLease=($.id("lease").value)?$.id("lease").value:1440;var tmpDomain=($.id("domain").value)?$.id("domain").value:"";var tmpDnsserver1=($.id("dnsserver1").value)?$.id("dnsserver1").value:"0.0.0.0";var tmpDnsserver2=($.id("dnsserver2").value)?$.id("dnsserver2").value:"0.0.0.0";var tmpRmtSrv=($.id("rmtSrv").value)?$.id("rmtSrv").value:"0.0.0.0";$.act(ACT_SET,LAN_HOST_CFG,dhcpCfg.__stack,null,["DHCPServerEnable="+dhcpEnable,"minAddress="+$.ip2ip(tmpMinAddr),"maxAddress="+$.ip2ip(tmpMaxAddr),"IPRouters="+$.ip2ip(tmpGateway),"DHCPLeaseTime="+(tmpLease*60),"domainName="+tmpDomain,"DNSServers="+$.ip2ip(tmpDnsserver1)+","+$.ip2ip(tmpDnsserver2),"DHCPRelay="+dhcpRelayEnable,"X_TP_DhcpRelayServer="+$.ip2ip(tmpRmtSrv)]);$.exe(function(err){if(!err){$.loadMain("dhcp.htm")}})};</script>
<p class="et T" id="et">DHCP Settings</p>
<div class="con1 L">
<p class="ct"></p>
<p class="bl"></p>
<div class="con2">


<p class="br"></p>

<p class="L2"><b class="item L T" id="t_dhcp">DHCP Server:</b>
<input name="dhcpserver" id="dhcp_disable" type="radio" onclick="changeDhcpMode()" /><span class="T T_dis">Disable</span>
<input name="dhcpserver" id="dhcp_enable" type="radio" onclick="changeDhcpMode()"/><span class="T T_en">Enable</span>

</p>


<p class="L2"><b class="item L T" id="t_poolstart">Start IP Address:</b><input id="ip1" type="text" class="text" size="15" value="0.0.0.0" maxlength="15"/></p>
<p class="L2"><b class="item L T" id="t_poolend">End IP Address:</b><input id="ip2" type="text" class="text" size="15" value="0.0.0.0" maxlength="15"/></p>
<p class="L2"><b class="item L T" id="t_leasetime">Address Lease Time:</b><input id="lease" type="text" class="text" value="120" size="4"  maxlength="4"/> <span class="T T_minutes">minutes</span> <span class="T" id="t_leaseval">(1~2880 minutes, the default value is 120)</span></p>
<p class="L2"><b class="item L T T_defgw">Default Gateway:</b><input id="gateway" type="text" class="text" value="0.0.0.0" size="15" maxlength="15"/><span class="T T_optional">(optional)</span></p>
<p class="L2"><b class="item L T" id="t_defdomain">Default Domain:</b><input id="domain" type="text" class="text" value="" size="15" maxlength="30"/><span class="T T_optional">(optional)</span></p>
<p class="L2"><b class="item L T T_dns">DNS Server:</b><input id="dnsserver1" type="text" class="text" value="0.0.0.0" size="15" maxlength="15"/><span class="T T_optional">(optional)</span></p>
<p class="L2"><b class="item L T T_secdns">Secondary DNS Server:</b><input id="dnsserver2" type="text" class="text" value="0.0.0.0" size="15" maxlength="15"/><span class="T T_optional">(optional)</span></p>

<div id="relay_div" class="nd">
<p class="br"></p>
<p class="L1"><b class="item L T" id="t_remote">Remote Server Address:</b><input id="rmtSrv" type="text" class="text" value="0.0.0.0" size="15" maxlength="15"/></p>
<p class="L1"><i class="T" id="t_relay_warn">Note: You have to disable NAT of the WAN connections. Or the DHCP Relay may not take effect!</i></p>
</div>
</div>
<p class="bl"></p>
<p class="tail" id="tail">
<input type="button" class="button L T T_save" id="saveBtn" value="Save" onclick="doSave();"/>
<input type="button" class="button L T T_back" id="returnBtn" value="Back" onclick="$.loadMain('dhcp.htm')" /></p>
</div>
<script language="javascript" type="text/javascript">$.loadHelpFrame("LanDhcpServerHelpRpm.htm");var ipList;var dhcpCfg;init();</script>