<script language="javascript" type="text/javascript">var blank="&nbsp;&nbsp;&nbsp;";var strTest="<span>Testing</span>";var strTestGif="<span><img src='./img/check.gif'/></span>";var strPass="<span class='T T_pass' style=\"color:green\">"+m_str.pass+"</span>";var strFail="<span class='T T_fail' style=\"color:#C11C66\">"+m_str.fail+"</span>";var strSkip="<span class='T T_skip' style=\"color:#ff9900\">"+m_str.skip+"</span>";var strWait="wait";var strFinish="<span class='T T_diag_end'>"+s_str.diag_end+"</span>";var strStop="<span class='T T_diag_pause'>"+s_str.diag_pause+"</span>";var dslSubTest=new Array();dslSubTest[0]="dslTest|<span class='T T_diag_dsl'>"+s_str.diag_dsl+"</span>|hlpDsl.htm";var atmSubTest=new Array();atmSubTest[0]="atmTest1|ATM OAM Segment Ping|hlpAtm.htm";atmSubTest[1]="atmTest2|ATM OAM end to end Ping|hlpAtm.htm";var pppSubTest=new Array();pppSubTest[0]="pppTestIdel|<span class='T T_diag_ppp'>"+s_str.diag_ppp+"</span>|hlpPpp.htm";pppSubTest[1]="pppTestAuth|<span class='T T_diag_auth'>"+s_str.diag_auth+"</span>|hlpPpp.htm";pppSubTest[2]="pppTestIp|<span class='T T_diag_ip'>"+s_str.diag_ip+"</span>|hlpPpp.htm";var dhcpSubTest=new Array();dhcpSubTest[0]="dhcpTestIdel|<span class='T T_diag_dhcp'>"+s_str.diag_dhcp+"</span>|hlpDhcp.htm";dhcpSubTest[1]="dhcpTestIp|<span class='T T_diag_ip'>"+s_str.diag_ip+"</span>|hlpDhcp.htm";var wanSubTest=new Array();wanSubTest[0]="wanTest|<span class='T T_diag_gw'>"+s_str.diag_gw+"</span>|hlpWan.htm";var internetSubTest=new Array();internetSubTest[0]="interTestDns|<span class='T T_diag_dns'>"+s_str.diag_dns+"</span>|hlpInternet.htm";internetSubTest[1]="interTestRoot|<span class='T T_diag_root'>"+s_str.diag_root+"</span>|hlpInternet.htm";internetSubTest[2]="interTest|<span class='T T_diag_ncsi'>"+s_str.diag_ncsi+"</span>|hlpInternet.htm";var bridgeTest=new Array();bridgeTest[0]=dslSubTest;bridgeTest[1]=atmSubTest;var dynamicIpoeTest=new Array();dynamicIpoeTest[0]=dslSubTest;dynamicIpoeTest[1]=atmSubTest;dynamicIpoeTest[2]=dhcpSubTest;dynamicIpoeTest[3]=wanSubTest;var staticIpoeTest=new Array();staticIpoeTest[0]=dslSubTest;staticIpoeTest[1]=atmSubTest;staticIpoeTest[2]=wanSubTest;var ethDynamicIpoeTest=new Array();ethDynamicIpoeTest[0]=dhcpSubTest;ethDynamicIpoeTest[1]=wanSubTest;var ethStaticIpoeTest=new Array();ethStaticIpoeTest[0]=wanSubTest;var pppTest=new Array();pppTest[0]=dslSubTest;pppTest[1]=atmSubTest;pppTest[2]=pppSubTest;pppTest[3]=wanSubTest;var ethPPPTest=new Array();ethPPPTest[0]=pppSubTest;ethPPPTest[1]=wanSubTest;var mainTest;var internetTest;var phase;var count;var circleCount=0;var state;var wanList=new Array();var wanType=new Array();var wanIndex=0;var wanInternetIdx=-1;var mainDns="";function disNewLine(info,stat){var display_table=$.id("display_table");var newRow=display_table.insertRow(-1);var newCell=newRow.insertCell(-1);newCell.width="20px";$.h(newCell,"");newCell=newRow.insertCell(-1);newCell.width="372px";if(""==stat){$.h(newCell,info)}else{$.h(newCell,blank+info)}newCell=newRow.insertCell(-1);newCell.width="128px";$.h(newCell,stat)}function clearTbl(){while($.id("display_table").rows.length>0){$.id("display_table").deleteRow(-1)}}function clear(){mainTest="";internetTest="";count="";phase="";state=""}function loadTest(){if("Internet"==$.id("diagType").value){if(-1==wanInternetIdx){disNewLine("<span class='T T_no_internet'>"+s_str.no_internet+"</span>","");clear();return}wanIndex=wanInternetIdx;internetTest=internetSubTest;disNewLine("<span class='T T_diag_surf'>"+s_str.diag_surf+"</span>","")}else{internetTest="";disNewLine(wanList[wanIndex].name,"")}var type="";var idx=0;for(idx=0;idx<wanType.length;idx++){if((wanList[wanIndex].stackId).charAt(0)==wanType[idx].wanStack){type=wanType[idx].wanType;break}}if(""==type){type="DSL"}switch(wanList[wanIndex].testType){case"bridge":mainTest=bridgeTest;break;case"dynamic":if("DSL"==type){mainTest=dynamicIpoeTest}else{mainTest=ethDynamicIpoeTest}break;case"static":if("DSL"==type){mainTest=staticIpoeTest}else{mainTest=ethStaticIpoeTest}break;case"ppp":if("DSL"==type){mainTest=pppTest}else{mainTest=ethPPPTest}break;default:mainTest="";break}count="";state=""}function doDiag(){if("work"==phase){phase="stop";disNewLine("<span class='T T_diag_pause'>"+s_str.diag_pause+"</span>","");$.id("testButton").value=m_str.start;return}clear();clearTbl();wanIndex=0;loadTest();$.id("testButton").value=m_str.stop;phase="work";timeoutfunc()}function doStop(){phase="next";return}function dslTest(code){if(""==state){state="test";return strTest}else{var wanDslInfList=$.act(ACT_GL,WAN_DSL_INTF_CFG,null,null,["status"]);if(!$.exe()){for(var i=0;i<wanDslInfList.length;i++){if("Up"==wanDslInfList[i].status){return strPass}}}doStop();return strFail}}function atmTest1(code){if(""==state){var diagCommand={};diagCommand.currCommand=4;diagCommand.currHost=wanList[wanIndex].name;diagCommand.lastCommand=0;diagCommand.lastHost="0";$.act(ACT_SET,DIAG_TOOL,null,null,diagCommand);if(!$.exe()){state="test";return strTest}else{doStop();return strFail}}else{var diagCommand=$.act(ACT_GET,DIAG_TOOL,null,null);if(!$.exe()){if((4==diagCommand.lastCommand)&&(wanList[wanIndex].name==diagCommand.lastHost)&&(0!=diagCommand.lastResult)){if(1==diagCommand.lastResult){return strPass}}else{return strWait}}doStop();return strFail}return"atmTest1"}function atmTest2(code){if(""==state){var diagCommand={};diagCommand.currCommand=5;diagCommand.currHost=wanList[wanIndex].name;diagCommand.lastCommand=0;diagCommand.lastHost="0";$.act(ACT_SET,DIAG_TOOL,null,null,diagCommand);if(!$.exe()){state="test";return strTest}else{doStop();return strFail}}else{var diagCommand=$.act(ACT_GET,DIAG_TOOL,null,null);if(!$.exe()){if((5==diagCommand.lastCommand)&&(wanList[wanIndex].name==diagCommand.lastHost)&&(0!=diagCommand.lastResult)){if(1==diagCommand.lastResult){return strPass}}else{return strWait}}doStop();return strFail}return"atmTest1"}function pppTestIdel(code){if(""==state){state="test";return strTest}else{if("UP"!=wanList[wanIndex].status){if(("ERROR_ISP_TIME_OUT"==wanList[wanIndex].status)||("ERROR_NONE"==wanList[wanIndex].status)){doStop();return strFail}}return strPass}return"pppTestIdel"}function pppTestAuth(code){if(""==state){state="test";return strTest}else{if("UP"!=wanList[wanIndex].status){if("ERROR_AUTHENTICATION_FAILURE"==wanList[wanIndex].status){doStop();return strFail}}return strPass}return"pppTestAuth"}function pppTestIp(code){if(""==state){state="test";return strTest}else{if("UP"!=wanList[wanIndex].status){doStop();return strFail}else{return strPass}}return"pppTestIp"}function dhcpTestIdel(code){if(""==state){state="test";return strTest}else{if("UP"!=wanList[wanIndex].status){if(("ERROR_ISP_TIME_OUT"==wanList[wanIndex].status)||("ERROR_NONE"==wanList[wanIndex].status)){doStop();return strFail}}return strPass}return"dhcpTestIdel"}function dhcpTestIp(code){return pppTestIp(0);return"dhcpTestIp"}function wanTest(code){if(""==state){var diagCommand={};diagCommand.currCommand=2;diagCommand.currHost=wanList[wanIndex].gwIp;diagCommand.lastCommand=0;diagCommand.lastHost="0";$.act(ACT_SET,DIAG_TOOL,null,null,diagCommand);if(!$.exe()){state="test";return strTest}else{doStop();return strFail}}else{var diagCommand=$.act(ACT_GET,DIAG_TOOL,null,null);if(!$.exe()){if((2==diagCommand.lastCommand)&&(wanList[wanIndex].gwIp==diagCommand.lastHost)&&(0!=diagCommand.lastResult)){if(1==diagCommand.lastResult){return strPass}}else{return strWait}}return strFail}return"wanTest"}function interTestDns(code){if(""==state){var diagCommand={};diagCommand.currCommand=2;diagCommand.currHost=mainDns;diagCommand.lastCommand=0;diagCommand.lastHost="0";$.act(ACT_SET,DIAG_TOOL,null,null,diagCommand);if(!$.exe()){state="test";return strTest}else{doStop();return strFail}}else{var diagCommand=$.act(ACT_GET,DIAG_TOOL,null,null);if(!$.exe()){if((2==diagCommand.lastCommand)&&(mainDns==diagCommand.lastHost)&&(0!=diagCommand.lastResult)){if(1==diagCommand.lastResult){return strPass}}else{return strWait}}return strFail}return"interTestDns"}function interTestRoot(code){if(""==state){var diagCommand={};diagCommand.currCommand=1;diagCommand.currHost=mainDns;diagCommand.lastCommand=0;diagCommand.lastHost="0";$.act(ACT_SET,DIAG_TOOL,null,null,diagCommand);if(!$.exe()){state="test";return strTest}else{doStop();return strFail}}else{var diagCommand=$.act(ACT_GET,DIAG_TOOL,null,null);if(!$.exe()){if((1==diagCommand.lastCommand)&&(mainDns==diagCommand.lastHost)&&(0!=diagCommand.lastResult)){if(1==diagCommand.lastResult){return strPass}}else{return strWait}}return strFail}}function interTest(code){if(""==state){var diagCommand={};diagCommand.currCommand=3;diagCommand.currHost=mainDns;diagCommand.lastCommand=0;diagCommand.lastHost="0";$.act(ACT_SET,DIAG_TOOL,null,null,diagCommand);if(!$.exe()){state="test";return strTest}else{doStop();return strFail}}else{var diagCommand=$.act(ACT_GET,DIAG_TOOL,null,null);if(!$.exe()){if((3==diagCommand.lastCommand)&&(0!=diagCommand.lastResult)){if(1==diagCommand.lastResult){return strPass}}else{return strWait}}return strFail}return"interTest"}function testDispatch(subTest,code){switch(subTest[0]){case"dslTest":return dslTest(code);case"atmTest1":return atmTest1(code);case"atmTest2":return atmTest2(code);case"pppTestIdel":return pppTestIdel(code);case"pppTestAuth":return pppTestAuth(code);case"pppTestIp":return pppTestIp(code);case"dhcpTestIdel":return dhcpTestIdel(code);case"dhcpTestIp":return dhcpTestIp(code);case"wanTest":return wanTest(code);case"interTestDns":return interTestDns(code);case"interTestRoot":return interTestRoot(code);case"interTest":return interTest(code);default:alert("Unkown test");return 0}return 0}function testHandle(test){var idx=0;while(idx<test.length){if(circleCount<count){circleCount++;idx++;continue}var subTest=test[idx].split("|");var lastState=state;ret=testDispatch(subTest,0);if((""!=lastState)&&(strTest!=ret)&&(strWait!=ret)){$.id("display_table").deleteRow(-1)}if((strTest==ret)||(strWait==ret)){if(""==lastState){disNewLine(subTest[1],strTestGif)}return 0}else{if(strSkip==ret){disNewLine(subTest[1],strSkip);state="";count++;return 0}else{if(strPass==ret){disNewLine(subTest[1],strPass);state="";count++;continue}else{if(strFail==ret){disNewLine(subTest[1],strFail);state="";count++;return 0}}}}}return 1}function setTimer(){if("work"==phase){$.auto(function(){timeoutfunc();return false},200)}else{if(("next"==phase)&&(""==internetTest)){wanIndex++;if(wanIndex<wanList.length){loadTest();phase="work";setTimer();return}else{phase="stop";setTimer();return}}else{disNewLine("<span class='T T_diag_end'>"+s_str.diag_end+"</span>","");$.id("testButton").value=m_str.start;wanList=[];wanIndex=0;wanInternetIdx=-1;mainDns="";diagnosticInit();return}}}function timeoutfunc(){if("work"==phase){var idx=0;var jdx=0;circleCount=0;while(idx<mainTest.length){if(0==testHandle(mainTest[idx])){setTimer();return}idx++}if(count>=circleCount){if(0==testHandle(internetTest)){}else{phase="next"}setTimer();return}phase="stop";setTimer()}}function diagnosticInit(){clear();var idx=0;var wanIpConList=$.act(ACT_GL,WAN_IP_CONN,null,null);var wanPppConList=$.act(ACT_GL,WAN_PPP_CONN,null,null);var aliasName=$.act(ACT_GET,L3_FORWARDING,null,null,["__ifAliasName"]);var netCfg=$.act(ACT_GET,NET_CFG,null,null);var wanCommonInterfaceList=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null);if(!$.exe()){if(""==netCfg.DNSServers){mainDns="0"}else{var dnsServer=(netCfg.DNSServers).split(",");mainDns=dnsServer[0]}$.each(wanCommonInterfaceList,function(){wanType[idx]={};wanType[idx].wanStack=(this.__stack).charAt(0);wanType[idx].wanType=this.WANAccessType;idx++});idx=0;$.each(wanIpConList,function(){if(1==this.enable){wanList[idx]={};wanList[idx].name=this.name;if(("0"==mainDns)&&(netCfg.DNSifAliasName==this.name)&&("0"!=this.DNSServers)){mainDns=this.DNSServers}if(this.name==aliasName.__ifAliasName){wanInternetIdx=idx}if("IP_Bridged"==this.connectionType){wanList[idx].testType="bridge";wanList[idx].status="";wanList[idx].localIp="";wanList[idx].gwIp=""}else{if("IP_Routed"==this.connectionType){if("DHCP"==this.addressingType){wanList[idx].testType="dynamic";if("Connected"==this.connectionStatus){wanList[idx].status="UP"}else{wanList[idx].status=this.lastConnectionError}wanList[idx].localIp=this.externalIPAddress;wanList[idx].gwIp=this.defaultGateway}else{wanList[idx].testType="static";wanList[idx].status="";wanList[idx].localIp=this.externalIPAddress;wanList[idx].gwIp=this.defaultGateway}}}wanList[idx].stackId=this.__stack;wanList[idx].oidStr=WAN_IP_CONN;idx++}});$.each(wanPppConList,function(){if(1==this.enable){wanList[idx]={};wanList[idx].name=this.name;if(this.name==aliasName.__ifAliasName){wanInternetIdx=idx}if(("0"==mainDns)&&(netCfg.DNSifAliasName==this.name)&&("0"!=this.DNSServers)){mainDns=this.DNSServers}wanList[idx].testType="ppp";if("Connected"==this.connectionStatus){wanList[idx].status="UP"}else{wanList[idx].status=this.lastConnectionError}wanList[idx].localIp=this.externalIPAddress;wanList[idx].gwIp=this.remoteIPAddress;wanList[idx].stackId=this.__stack;wanList[idx].oidStr=WAN_PPP_CONN;idx++}});if(0==idx){$.id("diagType").disabled=true;$.id("testButton").disabled=true;disNewLine("<span class='T T_no_wan'>"+s_str.no_wan+"</span>","")}}};</script>
<p class="et T" id="et">Diagnostic Tools</p>
<div class="con1 M">
<p class="ct"></p>
<p class="bl"></p>
<div class="con2">
	<p class="L1 T" id="t_info">The Internet connection status of this device can be tested on this page.</p>
	<p class="br"></p>
	<p class="L1">
		<b class="item T" id="t_type">Diagnostic Type</b>
		<select id="diagType" name="diagType">
			<option class="T T_diag_surf" value="Internet">Test Internet surfing</option>
			<option class="T" value="Wan" id="t_surfwan">Test WAN interface connection</option>
		</select>
		<input type="button" id="testButton" class="button L T T_start" value="Start" onClick="doDiag()"/>
	</p>
	<p class="br"></p>
	<div class="M tbody bdr ts" style="height: 320px; overflow-y: scroll; background-color: beige">
		<table id="display_table" cellspacing="0" cellpadding="0" class="tbody M"></table>
	</div>
	<p class="br"></p>
</div>
<p class="bl"></p>
<p class="tail" id="tail"></p>
</div>
<script language="javascript" type="text/javascript">$.loadHelpFrame("DiagHelp.htm");diagnosticInit();</script>