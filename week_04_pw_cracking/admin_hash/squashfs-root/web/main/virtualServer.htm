<script language="javascript" type="text/javascript">var selAll;var index;var allStk;var allStkType;var vtlServ_stack;var vtlServ_stackType;var vtlServ_stackIndex;var param;function clickSel(){if(selAll==1){$.id("selAll").checked=0;selAll=0}}function doAdd(){param[0]=0;$.loadMain("vtlServEdit.htm",param)}function doEdit(val1,val2){param[0]=1;param[1]=val1;param[2]=val2;$.loadMain("vtlServEdit.htm",param)}function doSelAll(){if(selAll==0){for(var i=1;i<=index;i++){var vtlServid="vtlServid"+i;$.id(vtlServid).checked=1}vtlServ_stack=[];vtlServ_stackType=[];vtlServ_stackIndex=index;for(var j=0;j<vtlServ_stackIndex;j++){vtlServ_stack[j]=allStk[j];vtlServ_stackType[j]=allStkType[j]}selAll=1}else{if(selAll==1){for(var i=1;i<=index;i++){var vtlServid="vtlServid"+i;$.id(vtlServid).checked=0}vtlServ_stack=[];vtlServ_stackType=[];vtlServ_stackIndex=0;selAll=0}}}function selEntry(){vtlServ_stack=[];vtlServ_stackIndex=0;vtlServ_stackType=[];for(var i=1;i<=index;i++){var tmpEntryId="vtlServid"+i;if($.id(tmpEntryId).checked==1){vtlServ_stack[vtlServ_stackIndex]=allStk[i-1];vtlServ_stackType[vtlServ_stackIndex]=allStkType[i-1];vtlServ_stackIndex++}}}function init(){selAll=0;index=0;param=[];allStk=[];allStkType=[];vtlServ_param=[];vtlServ_stack=[];vtlServ_stackType=[];vtlServ_stackIndex=0;var wanInfStk;var vtlServList_IP=$.act(ACT_GL,WAN_IP_CONN_PORTMAPPING,null,null);var vtlServList_PPP=$.act(ACT_GL,WAN_PPP_CONN_PORTMAPPING,null,null);if(INCLUDE_USB_3G_DONGLE){var wan3glnkcfgList=$.act(ACT_GL,WAN_USB_3G_LINK_CFG,null,null,["enable","backupEnable"])}if(INCLUDE_L2TP){var vtlServList_L2TP=$.act(ACT_GL,WAN_L2TP_CONN_PORTMAPPING,null,null)}if(INCLUDE_PPTP){var vtlServList_PPTP=$.act(ACT_GL,WAN_PPTP_CONN_PORTMAPPING,null,null)}if(!$.exe()){var usb3gBackup=0;if(INCLUDE_USB_3G_DONGLE){$.each(wan3glnkcfgList,function(){if(this.enable==1){usb3gBackup=this.backupEnable;return false}})}var tbl=$.id("vtlServtbl");$.each(vtlServList_IP,function(){wanInfStk=(this.__stack).split(",")[0]+","+(this.__stack).split(",")[1]+","+(this.__stack).split(",")[2]+",0,0,0";var wanInf_IP=$.act(ACT_GET,WAN_IP_CONN,wanInfStk,null,["name"]);var getInf=0;if(INCLUDE_WAN_MODE){var sysMode=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);var wanCommIntfCfgList=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"])}if(!$.exe()){getInf=1;if(INCLUDE_WAN_MODE){var notShow=0;var mode=(sysMode.mode=="ETH")?"Ethernet":sysMode.mode;var tmpStk=$.stkPop(wanInfStk,2);$.each(wanCommIntfCfgList,function(){if(tmpStk==this.__stack&&this.WANAccessType!=mode){notShow=1;return}});if(notShow==1){return}}}var thisStk="["+this.__stack+"]";var row=tbl.insertRow(-1);index++;var cell=row.insertCell(-1);cell.width="5%";cell.innerHTML="<input type='checkbox' id='vtlServid"+index+"' onclick='clickSel();'/>";cell=row.insertCell(-1);cell.width="16%";if((this.externalPort!=0)&&(this.X_TP_ExternalPortEnd==0)){cell.innerHTML=this.externalPort}else{if((this.externalPort==0)&&(this.X_TP_ExternalPortEnd!=0)){cell.innerHTML=this.X_TP_ExternalPortEnd}else{if(this.externalPort==this.X_TP_ExternalPortEnd){cell.innerHTML=this.externalPort}else{cell.innerHTML=this.externalPort+"-"+this.X_TP_ExternalPortEnd}}}cell=row.insertCell(-1);cell.width="18%";cell.innerHTML=this.internalClient;cell=row.insertCell(-1);cell.width="15%";if((this.internalPort!=0)&&(this.X_TP_InternalPortEnd==0)){cell.innerHTML=this.internalPort}else{if((this.internalPort==0)&&(this.X_TP_InternalPortEnd!=0)){cell.innerHTML=this.X_TP_InternalPortEnd}else{if(this.internalPort==this.X_TP_InternalPortEnd){cell.innerHTML=this.internalPort}else{cell.innerHTML=this.internalPort+"-"+this.X_TP_InternalPortEnd}}}cell=row.insertCell(-1);cell.width="14%";if(this.portMappingProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.portMappingProtocol}cell=row.insertCell(-1);cell.width="12%";cell.innerHTML=((this.portMappingEnabled==1)?"<span class='T T_enabled'>"+m_str.enabled+"</span>":"<span class='T T_disabled'>"+m_str.disabled+"</span>");cell=row.insertCell(-1);cell.innerHTML="<span class='a T T_edit' onclick='doEdit(\"ip\", "+thisStk+");'>"+m_str.edit+"</span>";allStk[index-1]=this.__stack;allStkType[index-1]="ip"});$.each(vtlServList_PPP,function(){wanInfStk=(this.__stack).split(",")[0]+","+(this.__stack).split(",")[1]+","+(this.__stack).split(",")[2]+",0,0,0";var wanInf_PPP=$.act(ACT_GET,WAN_PPP_CONN,wanInfStk,null,["name"]);var getInf=0;if(INCLUDE_WAN_MODE){var sysMode=$.act(ACT_GET,SYS_MODE,null,null,["mode"]);var wanCommIntfCfgList=$.act(ACT_GL,WAN_COMMON_INTF_CFG,null,null,["WANAccessType"])}if(!$.exe()){getInf=1;var notShow=0;if(INCLUDE_WAN_MODE){var mode=(sysMode.mode=="ETH")?"Ethernet":sysMode.mode;var tmpStk=$.stkPop(wanInfStk,2);$.each(wanCommIntfCfgList,function(){if(tmpStk==this.__stack&&this.WANAccessType!=mode&&(this.WANAccessType!="USB_3G"||usb3gBackup!=1)){notShow=1;return}})}else{$.each(wanCommIntfCfgList,function(){if(tmpStk==this.__stack&&this.WANAccessType=="USB_3G"&&usb3gBackup!=1){notShow=1;return}})}if(notShow==1){return}}var thisStk="["+this.__stack+"]";var row=tbl.insertRow(-1);index++;var cell=row.insertCell(-1);cell.width="5%";cell.innerHTML="<input type='checkbox' id='vtlServid"+index+"'/>";cell=row.insertCell(-1);cell.width="16%";if((this.externalPort!=0)&&(this.X_TP_ExternalPortEnd==0)){cell.innerHTML=this.externalPort}else{if((this.externalPort==0)&&(this.X_TP_ExternalPortEnd!=0)){cell.innerHTML=this.X_TP_ExternalPortEnd}else{if(this.externalPort==this.X_TP_ExternalPortEnd){cell.innerHTML=this.externalPort}else{cell.innerHTML=this.externalPort+"-"+this.X_TP_ExternalPortEnd}}}cell=row.insertCell(-1);cell.width="18%";cell.innerHTML=this.internalClient;cell=row.insertCell(-1);cell.width="15%";if((this.internalPort!=0)&&(this.X_TP_InternalPortEnd==0)){cell.innerHTML=this.internalPort}else{if((this.internalPort==0)&&(this.X_TP_InternalPortEnd!=0)){cell.innerHTML=this.X_TP_InternalPortEnd}else{if(this.internalPort==this.X_TP_InternalPortEnd){cell.innerHTML=this.internalPort}else{cell.innerHTML=this.internalPort+"-"+this.X_TP_InternalPortEnd}}}cell=row.insertCell(-1);cell.width="14%";if(this.portMappingProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.portMappingProtocol}cell=row.insertCell(-1);cell.width="12%";cell.innerHTML=((this.portMappingEnabled==1)?"<span class='T T_enabled'>"+m_str.enabled+"</span>":"<span class='T T_disabled'>"+m_str.disabled+"</span>");cell=row.insertCell(-1);cell.innerHTML="<span class='a T T_edit' onclick='doEdit(\"ppp\", "+thisStk+");'>"+m_str.edit+"</span>";allStk[index-1]=this.__stack;allStkType[index-1]="ppp"});if(INCLUDE_L2TP){$.each(vtlServList_L2TP,function(){wanInfStk=(this.__stack).split(",")[0]+","+(this.__stack).split(",")[1]+",0,0,0,0";var wanInf_L2TP=$.act(ACT_GET,WAN_L2TP_CONN,wanInfStk,null,["name"]);var getInf=0;if(!$.exe()){getInf=1}var thisStk="["+this.__stack+"]";var row=tbl.insertRow(-1);index++;var cell=row.insertCell(-1);cell.width="5%";cell.innerHTML="<input type='checkbox' id='vtlServid"+index+"'/>";cell=row.insertCell(-1);cell.width="16%";if((this.externalPort!=0)&&(this.externalPortEnd==0)){cell.innerHTML=this.externalPort}else{if((this.externalPort==0)&&(this.externalPortEnd!=0)){cell.innerHTML=this.X_TP_ExternalPortEnd}else{if(this.externalPort==this.externalPortEnd){cell.innerHTML=this.externalPort}else{cell.innerHTML=this.externalPort+"-"+this.externalPortEnd}}}cell=row.insertCell(-1);cell.width="18%";cell.innerHTML=this.internalClient;cell=row.insertCell(-1);cell.width="15%";if((this.internalPort!=0)&&(this.internalPortEnd==0)){cell.innerHTML=this.internalPort}else{if((this.internalPort==0)&&(this.internalPortEnd!=0)){cell.innerHTML=this.internalPortEnd}else{if(this.internalPort==this.internalPortEnd){cell.innerHTML=this.internalPort}else{cell.innerHTML=this.internalPort+"-"+this.internalPortEnd}}}cell=row.insertCell(-1);cell.width="14%";if(this.portMappingProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.portMappingProtocol}cell=row.insertCell(-1);cell.width="12%";cell.innerHTML=((this.portMappingEnabled==1)?"<span class='T T_enabled'>"+m_str.enabled+"</span>":"<span class='T T_disabled'>"+m_str.disabled+"</span>");cell=row.insertCell(-1);cell.innerHTML="<span class='a T T_edit' onclick='doEdit(\"l2tp\", "+thisStk+");'>"+m_str.edit+"</span>";allStk[index-1]=this.__stack;allStkType[index-1]="l2tp"})}if(INCLUDE_PPTP){$.each(vtlServList_PPTP,function(){wanInfStk=(this.__stack).split(",")[0]+","+(this.__stack).split(",")[1]+",0,0,0,0";var wanInf_L2TP=$.act(ACT_GET,WAN_PPTP_CONN,wanInfStk,null,["name"]);var getInf=0;if(!$.exe()){getInf=1}var thisStk="["+this.__stack+"]";var row=tbl.insertRow(-1);index++;var cell=row.insertCell(-1);cell.width="5%";cell.innerHTML="<input type='checkbox' id='vtlServid"+index+"'/>";cell=row.insertCell(-1);cell.width="16%";if((this.externalPort!=0)&&(this.externalPortEnd==0)){cell.innerHTML=this.externalPort}else{if((this.externalPort==0)&&(this.externalPortEnd!=0)){cell.innerHTML=this.externalPortEnd}else{if(this.externalPort==this.externalPortEnd){cell.innerHTML=this.externalPort}else{cell.innerHTML=this.externalPort+"-"+this.externalPortEnd}}}cell=row.insertCell(-1);cell.width="18%";cell.innerHTML=this.internalClient;cell=row.insertCell(-1);cell.width="15%";if((this.internalPort!=0)&&(this.internalPortEnd==0)){cell.innerHTML=this.internalPort}else{if((this.internalPort==0)&&(this.internalPortEnd!=0)){cell.innerHTML=this.internalPortEnd}else{if(this.internalPort==this.internalPortEnd){cell.innerHTML=this.internalPort}else{cell.innerHTML=this.internalPort+"-"+this.internalPortEnd}}}cell=row.insertCell(-1);cell.width="14%";if(this.portMappingProtocol=="TCP or UDP"){cell.innerHTML=s_str.tcp_udp}else{cell.innerHTML=this.portMappingProtocol}cell=row.insertCell(-1);cell.width="12%";cell.innerHTML=((this.portMappingEnabled==1)?"<span class='T T_enabled'>"+m_str.enabled+"</span>":"<span class='T T_disabled'>"+m_str.disabled+"</span>");cell=row.insertCell(-1);cell.innerHTML="<span class='a T T_edit' onclick='doEdit(\"pptp\", "+thisStk+");'>"+m_str.edit+"</span>";allStk[index-1]=this.__stack;allStkType[index-1]="pptp"})}$.resize($.id("vtlServtbl"),8)}}function checkConflictFtpPort(exPort,exPortEnd){var ftpServer=$.act(ACT_GET,FTP_SERVER,null,null,null);var conflict=false;if($.exe()){return}if((ftpServer.enable==1)&&(ftpServer.accessFromInternet==1)){if(exPort==0){if(ftpServer.portNumber==exPortEnd){conflict=true}}else{if(exPortEnd==0){if(ftpServer.portNumber==exPort){conflict=true}}else{if((exPort<=ftpServer.portNumber)&&(ftpServer.portNumber<=exPortEnd)){conflict=true}}}}if(conflict){if(confirm(c_str.forwarding_ftp_conflict)){$.act(ACT_SET,FTP_SERVER,null,null,["accessFromInternet=0"]);$.exe();return true}else{$.reload();return false}}return true}function doEnable(obj){selEntry();if(vtlServ_stackIndex==0){$.alert(ERR_SEL_INVAD);return}$.addLoading(obj);for(var i=0;i<vtlServ_stackIndex;i++){if(vtlServ_stackType[i]=="ip"){if(INCLUDE_USB_FTP_SERVER){var vsEntry=$.act(ACT_GET,WAN_IP_CONN_PORTMAPPING,vtlServ_stack[i],null,null);$.exe();if(!checkConflictFtpPort(vsEntry.externalPort,vsEntry.X_TP_ExternalPortEnd)){return}}$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,vtlServ_stack[i],null,["portMappingEnabled=1"])}else{if(vtlServ_stackType[i]=="ppp"){if(INCLUDE_USB_FTP_SERVER){var vsEntry=$.act(ACT_GET,WAN_PPP_CONN_PORTMAPPING,vtlServ_stack[i],null,null);$.exe();if(!checkConflictFtpPort(vsEntry.externalPort,vsEntry.X_TP_ExternalPortEnd)){return}}$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,vtlServ_stack[i],null,["portMappingEnabled=1"])}else{if(vtlServ_stackType[i]=="l2tp"){if(INCLUDE_USB_FTP_SERVER){var vsEntry=$.act(ACT_GET,WAN_L2TP_CONN_PORTMAPPING,vtlServ_stack[i],null,null);$.exe();if(!checkConflictFtpPort(vsEntry.externalPort,vsEntry.externalPortEnd)){return}}$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,vtlServ_stack[i],null,["portMappingEnabled=1"])}else{if(vtlServ_stackType[i]=="pptp"){if(INCLUDE_USB_FTP_SERVER){var vsEntry=$.act(ACT_GET,WAN_PPTP_CONN_PORTMAPPING,vtlServ_stack[i],null,null);$.exe();if(!checkConflictFtpPort(vsEntry.externalPort,vsEntry.externalPortEnd)){return}}$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,vtlServ_stack[i],null,["portMappingEnabled=1"])}}}}}$.exe(function(ret){if(!ret){$.reload()}})}function doDisable(obj){selEntry();if(vtlServ_stackIndex==0){$.alert(ERR_SEL_INVAD);return}$.addLoading(obj);for(var i=0;i<vtlServ_stackIndex;i++){if(vtlServ_stackType[i]=="ip"){$.act(ACT_SET,WAN_IP_CONN_PORTMAPPING,vtlServ_stack[i],null,["portMappingEnabled=0"])}else{if(vtlServ_stackType[i]=="ppp"){$.act(ACT_SET,WAN_PPP_CONN_PORTMAPPING,vtlServ_stack[i],null,["portMappingEnabled=0"])}else{if(vtlServ_stackType[i]=="l2tp"){$.act(ACT_SET,WAN_L2TP_CONN_PORTMAPPING,vtlServ_stack[i],null,["portMappingEnabled=0"])}else{if(vtlServ_stackType[i]=="pptp"){$.act(ACT_SET,WAN_PPTP_CONN_PORTMAPPING,vtlServ_stack[i],null,["portMappingEnabled=0"])}}}}}$.exe(function(ret){if(!ret){$.reload()}})}function doDel(obj){selEntry();if(vtlServ_stackIndex==0){$.alert(ERR_SEL_INVAD);return}$.addLoading(obj);for(var i=0;i<vtlServ_stackIndex;i++){if(vtlServ_stackType[i]=="ip"){$.act(ACT_DEL,WAN_IP_CONN_PORTMAPPING,vtlServ_stack[i],null)}else{if(vtlServ_stackType[i]=="ppp"){$.act(ACT_DEL,WAN_PPP_CONN_PORTMAPPING,vtlServ_stack[i],null)}else{if(vtlServ_stackType[i]=="l2tp"){$.act(ACT_DEL,WAN_L2TP_CONN_PORTMAPPING,vtlServ_stack[i],null)}else{if(vtlServ_stackType[i]=="pptp"){$.act(ACT_DEL,WAN_PPTP_CONN_PORTMAPPING,vtlServ_stack[i],null)}}}}}$.exe(function(ret){if(!ret){$.reload()}})};</script>
<p class="et T" id="et">Virtual Server</p>
<div class="con1 XL">
<p class="ct"></p>
<p class="bl"></p>
<div class="con2">
<div class="XXL thead"><table class="XXL bdr tc">
<tr>
<th width="5%"><input type="checkbox" id="selAll" onclick="doSelAll();"/></th>
<th width="16%" class="T" id="t_port">Service Port</th>
<th width="18%" class="T T_ipaddr">IP Address</th>
<th width="15%" class="T" id="t_interPort">Internal Port</th>
<th width="14%" class="T T_proto">Protocol</th>
<th width="12%" class="T T_status">Status</th>
<th class="T T_edit">Edit</th>
</tr>
</table></div>
<div class="XXL tbody"><table id="vtlServtbl" class="XXL bdr tc"></table></div>
<p class="br"></p>
<p class="L1"><input type="button" class="button XL T T_addnew" value="Add New" onclick="doAdd();"/>
<input type="button" class="button XL T T_ensel" value="Enable Selected" onclick="doEnable(this);"/>
<input type="button" class="button XL T T_dissel" value="Disable Selected" onclick="doDisable(this);"/>
<input type="button" class="button XL T T_delsel" value="Delete Selected" onclick="doDel(this);"/></p>
</div>
<p class="bl"></p>
<p class="tail" id="tail"><input type="button" class="button L T T_refresh" value="Refresh" onclick="$.addLoading(this, 200, function(){$.reload()});" /></p>
</div>
<script language="javascript" type="text/javascript">$.loadHelpFrame("VirtualServerHelpRpm.htm");init();</script>